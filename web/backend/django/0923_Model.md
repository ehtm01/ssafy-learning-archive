# Model

### Model이란?
- **데이터베이스**와 Python 클래스(**객체**)로 추상화된 형태로 상호작용

---
- Django의 강력한 기능: 개발자가 데이터베이스에 대한 깊은 지식 없이도 쉽게 데이터 관리 가능
- 유지보수 및 확장성 증대: 데이터베이스 변경 시에도 코드 수정 최소화, 재사용 가능한 데이터 모델을 통해 개발 효율성 향상

### Model을 통한 DB(데이터베이스) 관리
- urls.py: 사용자 요청의 시작점
- views.py: 요청을 처리하고 models.py를 통해 데이터를 다룸
- **models.py**: **데이터베이스**를 정의하고, **데이터베이스**와 상호작용
- templates: views.py로부터 받은 데이터를 사용자에게 보여줄 화면을 구성

![0923_Model_2025-09-23-09-01-19](images/0923_Model_2025-09-23-09-01-19.png)

## Model class

### Model class란?
- DB의 테이블을 **정의**하고 데이터를 조작할 수 있는 기능들을 제공

---
- **Model class**는 데이터베이스 테이블의 구조를 설계하는 청사진 역할
- 어떤 데이터(컬럼)을 저장할지, 그 데이터의 형태는 어떠할지(타입, 길이 등)를 Python 코드로 명확히 정의함

### Model 클래스 작성

![0923_Model_2025-09-23-09-05-38](images/0923_Model_2025-09-23-09-05-38.png)

### Model 클래스 살펴보기
- 작성한 모델 클래스는 최종적으로 DB에 다음과 같은 테이블 구조를 만듦

![0923_Model_2025-09-23-09-06-37](images/0923_Model_2025-09-23-09-06-37.png)

- django.db.models 모듈의 Model이라는 부모 클래스를 상속받음
    - Model은 model에 관련된 모든 코드가 이미 작성되어 있는 Class
        - 개발자는 가장 중요한 **테이블 구조를 어떻게 설계할 지에 대한 코드만 작성하도록** 하기 위한 것<br>
        ("상속"을 활용한 프레임워크의 기능 제공)

            ![0923_Model_2025-09-23-09-10-55](images/0923_Model_2025-09-23-09-10-55.png)ㄴ

- 클래스 변수명
    - 테이블의 각 "필드(열) 이름"

![0923_Model_2025-09-23-09-09-42](images/0923_Model_2025-09-23-09-09-42.png)

- Model Field
    - 데이터베이스 테이블의 열(column)을 나타내는 중요한 구성 요소
    - "데이터의 유형"과 "제약 조건"을 정의

![0923_Model_2025-09-23-09-11-13](images/0923_Model_2025-09-23-09-11-13.png)

---
- **CharField**의 **max_length** 매개변수를 지정하는 것은 선택사항
- **SQLite**는 문자열 컬럼의 길이에 대한 엄격한 제한을 강제하지 않음
- 하지만, **<u>유효성 검사</u>** 및 컬럼에 들어갈 **데이터의 명확성**을 위해 명시적으로 설정하는 것은 여전히 매우 권장됨.

---
- 유효성 검사: 정해진 규칙이나 조건에 따라 데이터의 정확성을 확인하는 과정

# Model Field

### Model Field이란?
- DB 테이블의 **필드(열)** 정의
- **데이터 타입(Field types)** 및 **제약 조건(Field options)** 명시

---
- Django는 이러한 필드 정의를 바탕으로 데이터베이스 컬럼을 자동 생성하고, 데이터 입력 시 유효성 검사 등 필요한 기능 제공
- 정확한 필드 정의는 애플리케이션의 안정성을 높이는 데 필수적

### Model Field

![0923_Model_2025-09-23-09-25-10](images/0923_Model_2025-09-23-09-25-10.png)

## Field types
- 데이터베이스에 저장될 "**데이터의 종류**"를 정의
    - models 모듈의 클래스로 정의되어 있음

```py
# articles/models.py
class Article(models.Model):
    title = models.CharField(max_length=10)
    content = models.TextField()
```

#### CharField()
- 제한된 길이의 문자열을 저장
    - 필드의 최대 길이를 결정하는 max_length는 선택 옵션

#### TextField()
- 길이 제한이 없는 대용량 텍스트를 저장
    - 무한대는 아니며 사용하는 시스템에 따라 달라짐

### 주요 필드 유형
- 문자열 필드
    - CharField, TextField
- 날짜/시간 필드
    - DateField, TimeField, DateTimeField
- 숫자 필드
    - IntegerField, FloatField
- 파일 관련 필드
    - FileField, ImageField

## Field options

### Field options이란?
- 필드의 "**동작**"과 "**제약 조건**"을 정의

### 제약 조건(Constraint)이란?
- 특정 규칙을 강제하기 위해 테이블의 열이나 행에 적용되는 규칙이나 제한사항
    - **숫자만 저장**되도록 제한을 두거나 **문자가 100자** 까지만 저장되도록 하는 등의 제한 조건을 의미

### 주요 필드 옵션
- null
    - 데이터베이스에서 NULL 값을 허용할지 여부를 결정 (기본값: False)
- blank
    - form에서 빈 값을 허용할지 여부를 결정 (기본값: False)
- default
    - 필드의 기본값을 설정

![0923_Model_2025-09-23-09-31-05](images/0923_Model_2025-09-23-09-31-05.png)

# Migrations

### Migrations이란?
- model 클래스의 변경사항(**필드 생성, 수정 삭제** 등)을 DB에 최종 반영하는 방법
    - 모든 변경 사항이 코드로 관리되어 협업 시 모델 변경 내역에 대한 추적과 공유가 수월함.

### Django 모델 클래스와 Migration 과정
- 모델 정의부터 마이그레이션 파일 생성까지

    ![0923_Model_2025-09-23-09-35-16](images/0923_Model_2025-09-23-09-35-16.png)

- 생성된 최종 설계도(0001_initial.py) 마이그레이션 파일을 DB에 반영하기

    ![0923_Model_2025-09-23-09-36-43](images/0923_Model_2025-09-23-09-36-43.png)

### Migrations 과정 핵심 정리

![0923_Model_2025-09-23-09-37-46](images/0923_Model_2025-09-23-09-37-46.png)

### Migrations 핵심 명령어 2가지

![0923_Model_2025-09-23-09-38-17](images/0923_Model_2025-09-23-09-38-17.png)

- 마이그레이션 파일은 되도록 직접 건드리지 말 것.
- migrations 폴더에 자동으로 생성된 파일들은 직접 수정하거나 삭제하지 않는 것이 원칙

### Migration 경고 메시지
- Django 서버를 시작할 때 출력되는 migration 관련 경고 메시지
    - 이 메시지는 프로젝트 실행 시 **미적용 마이그레이션 파일**이 있을 때 나타남

![0923_Model_2025-09-23-09-40-35](images/0923_Model_2025-09-23-09-40-35.png)

- 해결방법
    - 경고 메시지에 명시된 대로 `python manage.py migrate` 명령어를 실행
- 중요한 이유
    - 최신 모델 변경 사항이 데이터베이스에 반영되지 않아 **프로젝트가 제대로 작동하지 않을 수 있음**

## 추가 Migrations

### 이미 생성된 테이블에 필드를 추가해야 한다면?
- 이미 기존 테이블이 존재하는 경우, 새 필드를 추가할 때 문제가 발생할 수 있음
    - 기존에 레코드가 있는 테이블에 새로운 필드를 추가하면 어떤 값으로 채울지 결정해야 함
    - Django의 **makemigrations** 실행 시 기본값 설정을 요구하는 프롬프트가 표시됨

        ![0923_Model_2025-09-23-09-43-16](images/0923_Model_2025-09-23-09-43-16.png)

### Migration 과정 - 추가 모델 필드 작성
- 새로운 필드 작성

    ![0923_Model_2025-09-23-09-43-53](images/0923_Model_2025-09-23-09-43-53.png)

- Model Field: models.**필드 유형**(*필드 옵션*)

---
> DateTimeField의 필드 옵션 (optional)
- auto_now
    - 데이터가 **저장될 때마다** 자동으로 현재 날짜시간을 저장
- auto_now_add
    - 데이터가 **처음 생성될 때만** 자동으로 현재 날짜시간을 저장

---
- 새로운 필드 추가 후 **makemigrations** 명령어 입력 `$ python manage.py makemigration`
    - 이미 기존 테이블이 존재하기 때문에 필드를 추가할 때 필드의 기본값 설정이 필요
    - **1번은 현재 대화를 유지하면서 직접 기본값을 입력하는 방법 v**
    - 2번은 현재 대화에서 나간 후 models.py에 기본값 관련 설정을 하는 방법

        ![0923_Model_2025-09-23-09-49-37](images/0923_Model_2025-09-23-09-49-37.png)

---
- 옵션 1: 일회성 기본값 제공
    - 현재 대화형 프롬프트에서 기본값을 직접 입력
    - 입력한 기본값은 기존의 모든 데이터 행에 적용

---
- 추가하는 필드의 기본값을 입력해야 하는 상황
- 날짜 데이터이기 때문에 직접 입력하기보다 Django가 제안하는 기본값을 사용하는 것을 권장
- 아무것도 입력하지 않고 enter를 누르면 Django가 제안하는 기본값으로 설정됨

    ![0923_Model_2025-09-23-10-01-07](images/0923_Model_2025-09-23-10-01-07.png)

- migrations 과정 종료 후 2번째 migration 파일이 생성됨을 확인
- 이처럼 Django는 설계도를 쌓아가면서 추후 문제가 생겼을 시 복구하거나 되돌릴 수 있도록 함
    - 마치 'git commit'과 유사

        ![0923_Model_2025-09-23-10-02-43](images/0923_Model_2025-09-23-10-02-43.png)

- migrate 후 테이블 필드 변화 확인

![0923_Model_2025-09-23-10-04-39](images/0923_Model_2025-09-23-10-04-39.png)

### 언제 Migration이 필요할까?
1. model class에 **변경사항** 발생
2. 반드시 새로운 **설계도 생성**
3. 이를 **DB에 반영**해야 함

- (1) model class 생성/수정 -> (2) makemigrations -> (3) migrate

# Admin site

## 관리자 인터페이스

### Django가 제공하는 관리자 인터페이스
- 관리자 인터페이스(Automatic admin interface)
    - Django가 추가 설치 및 설정없이 자동으로 제공하는 관리자 인터페이스
    - 주요 기능: 데이터베이스 모델의 **CRUD(생성, 읽기, 업데이트, 삭제)** 작업을 간편하게 수행할 수 있다.
    - 활용: 빠른 **프로토타이핑, 비개발자 데이터 관리, 내부 시스템 구축**에 이상적

### 1. Django admin 계정 생성
1. 터미널 열기
    - Django 프로젝트 폴더로 이동해서 터미널을 엶 (manage.py 파일이 있는 위치에서 진행)
2. 관리자 계정 생성 명령어 입력
    `$ python manage.py createsuperuser`
3. 정보 입력
    - 사용자 이름(username): 관리자 페이지에 로그인할 때 사용할 아이디를 입력
    - 이메일(email address): 선택 사항이라 입력하지 않고 엔터를 눌러 넘어가도 됨
    - 비밀번호(password): 로그인할 때 사용할 비밀번호 입력<b>(비밀번호 입력 시 콘솔 창에 아무 것도 나타나지 않음)</b>
    - 비밀번호 확인(password(again)): 비밀번호를 한 번 더 입력해서 확인

### 2. DB에 생성된 admin 계정 확인

![0923_Model_2025-09-23-10-24-17](images/0923_Model_2025-09-23-10-24-17.png)

### 3. 관리자 인터페이스 페이지
- 웹 브라우저를 열고 다음 주소로 이동
    - http://127.0.0.1:8000/admin
    - 생성한 관리자 계정으로 정상 로그인 확인

### 4. 관리자 인터페이스 접속 확인
- 로그인 후 아무 것도 보이지 않는 것이 정상
    - 우리가 만든 모델을 관리하려면 **추가 설정이 필요**

        ![0923_Model_2025-09-23-10-29-34](images/0923_Model_2025-09-23-10-29-34.png)

### 5. Admin site 모델 클래스 등록 및 확인
- admin.py에 작성한 모델 클래스를 등록해야만 admin site에서 확인 가능

    ![0923_Model_2025-09-23-10-32-59](images/0923_Model_2025-09-23-10-32-59.png)

    ![0923_Model_2025-09-23-10-33-11](images/0923_Model_2025-09-23-10-33-11.png)

### 6. 데이터 생성, 수정, 삭제 테스트
- Articles 앱에서 article에 대한 <b>CRUD(생성, 읽기, 업데이트, 삭제)</b> 를 위한 페이지로 이동

    ![0923_Model_2025-09-23-10-34-23](images/0923_Model_2025-09-23-10-34-23.png)

- 새로운 Article **생성**

![0923_Model_2025-09-23-10-34-43](images/0923_Model_2025-09-23-10-34-43.png)

- 성공 메시지와 함께 등록된 Article이 모두 조회됨
- 데이터베이스에서도 확인 가능

![0923_Model_2025-09-23-10-35-48](images/0923_Model_2025-09-23-10-35-48.png)

- 상세 페이지 내에서 원하는 데이터를 수정 또는 삭제할 수 있음

![0923_Model_2025-09-23-10-36-25](images/0923_Model_2025-09-23-10-36-25.png)

# 참고

## 데이터베이스 초기화

### 데이터베이스 초기화 방법
1. Migration 파일 삭제
    - makemigrations 명령어로 생성되는 설계도(Migration 파일)

2. db.sqlite3 파일 삭제

![0923_Model_2025-09-23-10-38-17](images/0923_Model_2025-09-23-10-38-17.png)

## Migrations 관련

### Migrations 기타 명령어
- showmigrations
    - migrations 파일들이 migrate 되었는지 안 되었는지 여부를 확인하는 명령어
    - [X] 표시가 있으면 migrate가 완료되었음을 의미<br>
    `$ python manage.py showmigrations`

- sqlmigrate
    - 해당 migrations 파일이 SQL 언어(DB에서 사용하는 언어)로 어떻게 번역되어 DB에 전달되는지 확인하는 명령어
    - python manage.py sqlmigrate <앱 이름> <마이그레이션 이름><br>
    `$ python manage.py sqlmigrate articles 0001`

### 최초 migrate 시 출력 내용이 많은 이유는?
- Django 프로젝트가 동작하기 위해 미리 작성되어있는 **기본 내장 app**들에 대한 migration 파일들이 함께 migrate 되기 때문

    ![0923_Model_2025-09-23-10-41-48](images/0923_Model_2025-09-23-10-41-48.png)

## SQLite

### SQLite란?
- **데이터베이스 관리 시스템** 중 하나이며 **Django의 기본 데이터베이스**로 사용됨
    - 파일 기반: 데이터베이스가 하나의 파일로 저장되어, 설치/설정 없이 **간편하게 복사/이동/백업** 가능
    - 가볍고 빠름: 별도 서버 없이 파일로 직접 데이터 처리, 소규모 앱이나 모바일 환경에 최적화
    - 높은 호환성: 다양한 운영체제와 프로그래밍 언어에서 폭넓게 사용 가능

### SQLite 주의사항
- db.sqlite3 파일은 Git 등 **버전 관리 시스템에서 관리하지 않는 것이 원칙**
    - 데이터가 변경될 때마다 **파일 전체가 변경됨**
- SQLite 파일은 **로컬 컴퓨터에 저장된 데이터 기록**
- .gitignore 파일에 db.sqlite3를 추가하여 **Git 버전 관리에서 제외**해야 함

### 실습
- migrate
    - 2665. 장고 model 만들기 예제 1
- Admin site
    - 2666. 장고 model 만들기 예제 2
    - 3230. 상품 관리 시스템 만들기 - 데이터 생성과 관리
- Model class
    - 3229. 상품 관리 시스템 만들기 - 앱 생성과 모델 정의
